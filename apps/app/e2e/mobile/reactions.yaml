# Reactions / Like E2E Test
# Tests the reaction/like functionality on the property preview card.
# Navigates to a property at high zoom, verifies the Like button on the preview card,
# and taps it to check the response (auth gate for unauthenticated users).
#
# Prerequisites:
# - App installed on emulator, Metro dev server running
# - Backend API accessible with seeded data
#
# Usage:
# maestro test apps/app/e2e/mobile/reactions.yaml

appId: nl.huishype.app
tags:
  - feature:reactions
  - feature:like
---
# Launch the app
- launchApp

# Handle Expo Dev Client server picker if shown
- tapOn:
    text: ".*10.0.2.2:8081.*"
    optional: true

# Wait for app to fully load
- extendedWaitUntil:
    visible: "HuisHype"
    timeout: 60000

# Dismiss Expo developer menu if it appears
- tapOn:
    text: "Ã—"
    optional: true
- tapOn:
    point: "50%,30%"
    optional: true
- waitForAnimationToEnd

# Wait for map to render
- extendedWaitUntil:
    visible: "Zoom.*"
    timeout: 20000

- takeScreenshot: maestro-screenshots/reactions_01_map_loaded

# Zoom in to z17+ where individual property markers are visible
- tapOn:
    text: "+"
- waitForAnimationToEnd
- tapOn:
    text: "+"
- waitForAnimationToEnd
- tapOn:
    text: "+"
- waitForAnimationToEnd
- tapOn:
    text: "+"
- waitForAnimationToEnd

# One more zoom to z18 for denser markers
- tapOn:
    text: "+"
- waitForAnimationToEnd

- takeScreenshot: maestro-screenshots/reactions_02_zoomed_to_z18

# Tap multiple screen positions to select a property
- tapOn:
    point: "50%,50%"
- waitForAnimationToEnd

- tapOn:
    point: "30%,40%"
    optional: true
- waitForAnimationToEnd

- tapOn:
    point: "70%,60%"
    optional: true
- waitForAnimationToEnd

- tapOn:
    point: "40%,30%"
    optional: true
- waitForAnimationToEnd

- tapOn:
    point: "60%,70%"
    optional: true
- waitForAnimationToEnd

- takeScreenshot: maestro-screenshots/reactions_03_after_taps

# Verify preview card appeared with Like button
- assertVisible:
    text: "Like"

- takeScreenshot: maestro-screenshots/reactions_04_preview_card_with_like

# Verify other action buttons are also visible
- assertVisible:
    text: "Comment"

- assertVisible:
    text: "Guess"

- takeScreenshot: maestro-screenshots/reactions_05_all_action_buttons

# Tap the Like button
- tapOn:
    text: "Like"
- waitForAnimationToEnd

- takeScreenshot: maestro-screenshots/reactions_06_after_like_tap

# Since the Like handler currently just logs (TODO: auth gate not yet implemented),
# verify the app is still stable after tapping Like.
# When auth is implemented, this would show a sign-in modal.
# For now, check the preview card is still visible.
- assertVisible:
    text: "Like"
    optional: true

- assertVisible:
    text: "Comment"
    optional: true

# Check if auth modal appeared (for future when Like auth gate is added)
- assertVisible:
    text: "Sign In"
    optional: true

- assertVisible:
    text: ".*Sign in.*"
    optional: true

- takeScreenshot: maestro-screenshots/reactions_07_post_like_state

# Tap on the map area to dismiss any preview card or overlay
# Using a point away from the preview card (top area of the map)
- tapOn:
    point: "50%,20%"
    optional: true
- waitForAnimationToEnd

- takeScreenshot: maestro-screenshots/reactions_08_after_dismiss

# Verify the map is still accessible
- extendedWaitUntil:
    visible: "Zoom.*"
    timeout: 10000

# Verify app is still functional
- assertVisible: "Map"
- assertVisible: "Feed"

- takeScreenshot: maestro-screenshots/reactions_09_final_state
