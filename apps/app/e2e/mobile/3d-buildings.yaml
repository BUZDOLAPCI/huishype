# 3D Buildings Zoom Test
# Tests that 3D buildings become visible at high zoom levels (z14+).
# Uses the +/- zoom buttons to reach zoom level 15+ where buildings should extrude.
# The map has a default pitch of 50 degrees to make 3D buildings visible.
#
# Prerequisites:
# - App installed on emulator, Metro dev server running
# - Backend API accessible with seeded data
#
# Usage:
# maestro test apps/app/e2e/mobile/3d-buildings.yaml

appId: nl.huishype.app
tags:
  - feature:map
  - feature:3d-buildings
---
# Launch the app
- launchApp

# Handle Expo Dev Client server picker if shown
- tapOn:
    text: ".*10.0.2.2:8081.*"
    optional: true

# Wait for app to fully load
- extendedWaitUntil:
    visible: "HuisHype"
    timeout: 60000

# Dismiss Expo developer menu if it appears
- tapOn:
    text: "Ã—"
    optional: true
- tapOn:
    point: "50%,30%"
    optional: true
- waitForAnimationToEnd

# Wait for map to render (zoom indicator confirms map is ready)
- extendedWaitUntil:
    visible: "Zoom.*"
    timeout: 20000

# Take initial screenshot at default zoom (z13 with 50 degree pitch)
# At z13, buildings should still be 2D (flat)
- takeScreenshot: maestro-screenshots/3d_buildings_01_default_zoom_z13

# Zoom in towards 3D building threshold (z14)
# First zoom: Z13 -> Z14 (3D buildings start appearing at z14)
- tapOn:
    text: "+"
- waitForAnimationToEnd
- takeScreenshot: maestro-screenshots/3d_buildings_02_zoom_z14

# Second zoom: Z14 -> Z15 (3D buildings should be fully visible)
- tapOn:
    text: "+"
- waitForAnimationToEnd
- takeScreenshot: maestro-screenshots/3d_buildings_03_zoom_z15

# Third zoom: Z15 -> Z16 (buildings should be clearly 3D)
- tapOn:
    text: "+"
- waitForAnimationToEnd
- takeScreenshot: maestro-screenshots/3d_buildings_04_zoom_z16

# Fourth zoom: Z16 -> Z17 (close-up on 3D buildings)
- tapOn:
    text: "+"
- waitForAnimationToEnd
- takeScreenshot: maestro-screenshots/3d_buildings_05_zoom_z17

# Fifth zoom: Z17 -> Z18 (detailed 3D building view)
- tapOn:
    text: "+"
- waitForAnimationToEnd
- takeScreenshot: maestro-screenshots/3d_buildings_06_zoom_z18

# Take screenshot to verify 3D buildings are visible
# At z18 with 50 degree pitch, buildings should have visible 3D extrusion
- takeScreenshot: maestro-screenshots/3d_buildings_07_high_zoom_3d_view

# Verify zoom indicator shows high zoom level
- assertVisible:
    text: "Zoom.*"

# Zoom out to verify transition back to 2D
- tapOn:
    text: "-"
- waitForAnimationToEnd
- tapOn:
    text: "-"
- waitForAnimationToEnd
- tapOn:
    text: "-"
- waitForAnimationToEnd
- tapOn:
    text: "-"
- waitForAnimationToEnd
- takeScreenshot: maestro-screenshots/3d_buildings_08_zoomed_back_to_z14

# Continue zooming out to z13 (below 3D threshold)
- tapOn:
    text: "-"
- waitForAnimationToEnd
- takeScreenshot: maestro-screenshots/3d_buildings_09_zoomed_back_to_z13

# Verify map is still functional
- extendedWaitUntil:
    visible: "Zoom.*"
    timeout: 10000

# Verify tab navigation still works
- assertVisible: "Map"
- assertVisible: "Feed"

- takeScreenshot: maestro-screenshots/3d_buildings_10_final_state
