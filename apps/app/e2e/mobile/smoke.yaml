# HuisHype Mobile Smoke Test
# Verifies the app launches, connects to Metro, and renders the map.
#
# Prerequisites:
# - Install Maestro: curl -Ls "https://get.maestro.mobile.dev" | bash
# - Build the app: eas build --profile development --platform android
# - Run emulator with the app installed
# - Start Metro: cd apps/app && npx expo start
#
# Usage:
# maestro test apps/app/e2e/mobile/smoke.yaml

appId: nl.huishype.app
---
# Launch the app
- launchApp

# Handle Expo Dev Client: tap server picker if shown (skipped if auto-connected)
- tapOn:
    text: ".*10.0.2.2:8081.*"
    optional: true

# Wait for the app to fully load (header appears behind dev menu too)
- extendedWaitUntil:
    visible: "HuisHype"
    timeout: 60000

# Dismiss Expo developer menu onboarding popup if it appears
# The X close button is in the top-right of the bottom sheet popup
- tapOn:
    text: "Ã—"
    optional: true

# Also try tapping on the map area to dismiss any remaining overlay
- tapOn:
    point: "50%,30%"
    optional: true

# Wait a moment for any dismissal animation
- waitForAnimationToEnd

# Verify the tab bar is visible
- assertVisible: "Map"
- assertVisible: "Feed"

# Take screenshot showing the app loaded
- takeScreenshot: maestro-screenshots/smoke_test_app_loaded

# Verify the map loaded (zoom indicator appears once map renders)
- extendedWaitUntil:
    visible: "Zoom.*"
    timeout: 15000

- takeScreenshot: maestro-screenshots/smoke_test_map_rendered

# Switch to Feed tab
- tapOn: "Feed"

# Verify feed screen loads (filter chips visible)
- extendedWaitUntil:
    visible: "All"
    timeout: 15000

- assertVisible: "Feed"
- takeScreenshot: maestro-screenshots/smoke_test_feed_loaded

# Switch back to Map tab
- tapOn: "Map"

- extendedWaitUntil:
    visible: "Zoom.*"
    timeout: 10000

- takeScreenshot: maestro-screenshots/smoke_test_back_to_map
