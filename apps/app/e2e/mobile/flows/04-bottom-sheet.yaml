appId: nl.huishype.app
---
# 04-bottom-sheet.yaml — Bottom Sheet Browse + Auth Gates (unauthenticated)
# Tests the bottom sheet expansion, content sections, and auth gate modals.
# This is a sub-flow; property (Beeldbuisring 41) has been resolved via search.
#
# KNOWN LIMITATION: The GroupPreviewCard is inside a MapLibre <Marker>
# (GL texture, not real Android views). Maestro cannot tap preview card
# buttons. Instead, we expand the bottom sheet directly by swiping up
# from the peek position (10% height).

# The PropertyBottomSheet should be in peek state (index=0, 10% height)
# after search resolved the property. Wait for property data to load.
# The property-header-carousel resource-id appears when data loads.
- extendedWaitUntil:
    visible:
        id: "property-header-carousel"
    timeout: 15000

# Swipe up to expand to partial height (50%).
# Start at 88% to avoid tab bar at screen bottom, end at 40%.
- swipe:
    start: "50%,88%"
    end: "50%,40%"
    duration: 500
- waitForAnimationToEnd

- takeScreenshot: maestro-screenshots/full_flow_07_bottom_sheet_partial

# Wait for sheet content to become visible
- extendedWaitUntil:
    visible: ".*Beeldbuisring.*"
    timeout: 10000

# Swipe up further to fully expand the bottom sheet (90%)
- swipe:
    start: "50%,60%"
    end: "50%,15%"
    duration: 500
- waitForAnimationToEnd

- takeScreenshot: maestro-screenshots/full_flow_08_bottom_sheet_full

# --- Verify bottom sheet structural sections ---
# QuickActions (Save, Share buttons in bottom sheet)
- assertVisible:
    text: "Save"
    optional: true
- assertVisible:
    text: "Share"
    optional: true

# --- Auth gate: Like button in bottom sheet QuickActions ---
- tapOn:
    text: "Like"
    optional: true
- waitForAnimationToEnd

# Assert auth modal appears with "Sign In" header text (optional — Like may not have been tapped)
- extendedWaitUntil:
    visible: "Sign In"
    timeout: 5000
    optional: true

- takeScreenshot: maestro-screenshots/full_flow_09_like_auth_gate

# Dismiss auth modal if it appeared
- tapOn:
    text: "Close"
    optional: true
- waitForAnimationToEnd

# --- Scroll to PriceGuessSection ---
- swipe:
    start: "50%,60%"
    end: "50%,30%"
    duration: 300
- waitForAnimationToEnd

# Verify price guess section exists (either auth prompt or submit form)
- assertVisible:
    text: "Guess the Price"
    optional: true

- takeScreenshot: maestro-screenshots/full_flow_10_price_section

# Continue scrolling to Comments section
- swipe:
    start: "50%,70%"
    end: "50%,30%"
    duration: 300
- waitForAnimationToEnd

# Verify "Comments" header visible (seeded fixture has 5 comments)
- assertVisible:
    text: "Comments"
    optional: true

# Verify comment input area shows auth prompt for unauthenticated users
- assertVisible:
    text: ".*Log in to comment.*"
    optional: true

# Tap "Popular" sort toggle (optional — requires comments to have loaded)
- tapOn:
    text: "Popular"
    optional: true
- waitForAnimationToEnd

- takeScreenshot: maestro-screenshots/full_flow_11_comments_section

# Scroll to see more of comments section
- swipe:
    start: "50%,70%"
    end: "50%,30%"
    duration: 300
- waitForAnimationToEnd

- takeScreenshot: maestro-screenshots/full_flow_12_bottom_sheet_scrolled
