appId: nl.huishype.app
---
# 05-login.yaml — Dev Login
# Uses the header "Log in" button to trigger auth modal, then Dev Login.
# This is a sub-flow; bottom sheet is fully expanded on the fixture property.
#
# KNOWN ISSUE: The bottom sheet can trigger a "NavigationStateContext" render
# error during complex state transitions. If the RN error overlay appears,
# we dismiss it.
#
# NOTE: Dev Login button is rendered outside the Reanimated Animated.View
# so that Android accessibility bounds are correct and Maestro can tap by text.

# Dismiss any React Native error overlay that may have appeared
- tapOn:
    text: "Dismiss"
    optional: true
- waitForAnimationToEnd

# After flow 04, the bottom sheet may be fully expanded or in error state.
# Tap the Map tab to navigate away and reset state.
- tapOn:
    text: "Map"
    optional: true
- waitForAnimationToEnd

# Dismiss bottom sheet by swiping down from handle area
- swipe:
    start: "50%,12%"
    end: "50%,95%"
    duration: 500
- waitForAnimationToEnd

# If there's still an error overlay, dismiss it
- tapOn:
    text: "Dismiss"
    optional: true
- waitForAnimationToEnd

# Verify map is visible with zoom indicator
- extendedWaitUntil:
    visible: "Zoom.*"
    timeout: 15000

# Tap the "Log in" button in the app header to trigger auth modal
- tapOn:
    id: "header-login-button"
- waitForAnimationToEnd

# Wait for modal slide-up animation to complete (300ms + buffer)
- waitForAnimationToEnd
- waitForAnimationToEnd

# Assert auth modal header is visible
- extendedWaitUntil:
    visible: "Sign In"
    timeout: 15000

- takeScreenshot: maestro-screenshots/full_flow_12b_auth_modal

# Dev Login button is rendered outside the Reanimated Animated.View
# so Android accessibility bounds are correct and Maestro can find it by label.
- tapOn:
    text: "Dev Login"
- waitForAnimationToEnd

# Wait for auth state transition to complete
- waitForAnimationToEnd
- waitForAnimationToEnd

# Dismiss any error overlay from auth state cascade
- tapOn:
    text: "Dismiss"
    optional: true
- waitForAnimationToEnd

- takeScreenshot: maestro-screenshots/full_flow_13_logged_in

# Verify we're back on the map with zoom indicator
# After auth, handleAuthStarting clears selectedPropertyId, so the bottom
# sheet should be gone and we should see the map.
- extendedWaitUntil:
    visible: "Zoom.*"
    timeout: 15000

# Verify login was successful — "Log in" button should no longer be visible
# (replaced by user avatar or profile button)
- takeScreenshot: maestro-screenshots/full_flow_14_post_login_map
